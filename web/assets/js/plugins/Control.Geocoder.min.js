(function(u,h){typeof exports=="object"&&typeof module<"u"?h(exports,require("leaflet")):typeof define=="function"&&define.amd?define(["exports","leaflet"],h):(u=typeof globalThis<"u"?globalThis:u||self,h(u["leaflet-control-geocoder"]={},u.L))})(this,function(u,h){"use strict";function N(i){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(i){for(const t in i)if(t!=="default"){const s=Object.getOwnPropertyDescriptor(i,t);Object.defineProperty(e,t,s.get?s:{enumerable:!0,get:()=>i[t]})}}return e.default=i,Object.freeze(e)}const n=N(h);function l(i,e){return Object.assign(e,i.geocodingQueryParams)}function p(i,e){return Object.assign(e,i.reverseQueryParams)}const D=/[&<>"'`]/g,A=/[&<>"'`]/,G={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function z(i){return G[i]}function W(i){return i==null?"":i?(i=""+i,A.test(i)?i.replace(D,z):i):i+""}function c(i,e){const t={Accept:"application/json"},s=new URL(i);return Object.entries(e).forEach(([o,r])=>{(Array.isArray(r)?r:[r]).forEach(a=>{s.searchParams.append(o,a)})}),fetch(s.toString(),{headers:t}).then(o=>o.json())}function I(i,e){return i.replace(/\{ *([\w_]+) *\}/g,(t,s)=>{let o=e[s];return o===void 0?o="":typeof o=="function"&&(o=o(e)),W(o)})}class v{options={serviceUrl:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",apiKey:""};constructor(e){n.Util.setOptions(this,e)}async geocode(e){const t=l(this.options,{token:this.options.apiKey,SingleLine:e,outFields:"Addr_Type",forStorage:!1,maxLocations:10,f:"json"});return(await c(this.options.serviceUrl+"/findAddressCandidates",t)).candidates.map(o=>{const r=new n.LatLng(o.location.y,o.location.x),a=new n.LatLngBounds(new n.LatLng(o.extent.ymax,o.extent.xmax),new n.LatLng(o.extent.ymin,o.extent.xmin));return{name:o.address,bbox:a,center:r}})}suggest(e){return this.geocode(e)}async reverse(e,t){const s=p(this.options,{location:e.lng+","+e.lat,distance:100,f:"json"}),o=await c(this.options.serviceUrl+"/reverseGeocode",s);if(!o||o.error)return[];const r=new n.LatLng(o.location.y,o.location.x),a=new n.LatLngBounds(r,r);return[{name:o.address.Match_addr,center:r,bbox:a}]}}function q(i){return new v(i)}class _{options={serviceUrl:"https://dev.virtualearth.net/REST/v1/Locations/"};constructor(e){n.Util.setOptions(this,e)}async geocode(e){const t=l(this.options,{query:e,key:this.options.apiKey}),s=await c(this.options.serviceUrl,t);return this._parseResults(s)}async reverse(e,t){const s=p(this.options,{key:this.options.apiKey}),o=await c(this.options.serviceUrl+e.lat+","+e.lng,s);return this._parseResults(o)}_parseResults(e){return e.resourceSets[0].resources.map(t=>{const s=t.bbox;return{name:t.name,bbox:new n.LatLngBounds([s[0],s[1]],[s[2],s[3]]),center:new n.LatLng(...t.point.coordinates)}})}}function H(i){return new _(i)}class b{options={apiKey:"",serviceUrl:"https://atlas.microsoft.com/search"};constructor(e){if(n.Util.setOptions(this,e),!this.options.apiKey)throw new Error("Azure Maps Geocoder requires an API key.")}async geocode(e){const t={"api-version":"1.0",query:e,"subscription-key":this.options.apiKey},s=this.options.serviceUrl+"/address/json";return((await c(s,t)).results||[]).map(r=>({name:r.address.freeformAddress,bbox:new n.LatLngBounds([r.viewport.topLeftPoint.lat,r.viewport.topLeftPoint.lon],[r.viewport.btmRightPoint.lat,r.viewport.btmRightPoint.lon]),center:new n.LatLng(r.position.lat,r.position.lon)}))}async reverse(e,t){const s={"api-version":"1.0",query:e.lat+","+e.lng,"subscription-key":this.options.apiKey},o=this.options.serviceUrl+"/address/reverse/json";return((await c(o,s)).addresses||[]).map(a=>({name:a.address.freeformAddress,bbox:new n.LatLngBounds([a.viewport.topLeftPoint.lat,a.viewport.topLeftPoint.lon],[a.viewport.btmRightPoint.lat,a.viewport.btmRightPoint.lon]),center:new n.LatLng(e.lat,e.lng)}))}}function V(i){return new b(i)}class y{options={serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json"};constructor(e){n.Util.setOptions(this,e)}async geocode(e){const t=l(this.options,{key:this.options.apiKey,address:e}),s=await c(this.options.serviceUrl,t);return this._parseResults(s)}async reverse(e,t){const s=p(this.options,{key:this.options.apiKey,latlng:e.lat+","+e.lng}),o=await c(this.options.serviceUrl,s);return this._parseResults(o)}_parseResults(e){return(e.results||[])?.map(t=>{const s=new n.LatLng(t.geometry.location.lat,t.geometry.location.lng),o=new n.LatLngBounds(new n.LatLng(t.geometry.viewport.northeast.lat,t.geometry.viewport.northeast.lng),new n.LatLng(t.geometry.viewport.southwest.lat,t.geometry.viewport.southwest.lng));return{name:t.formatted_address,bbox:o,center:s,properties:t.address_components}})}}function J(i){return new y(i)}class x{options={serviceUrl:"https://geocoder.api.here.com/6.2/",app_id:"",app_code:"",apiKey:"",maxResults:5};constructor(e){if(n.Util.setOptions(this,e),e?.apiKey)throw Error("apiKey is not supported, use app_id/app_code instead!")}geocode(e){const t=l(this.options,{searchtext:e,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1,maxresults:this.options.maxResults});return this.getJSON(this.options.serviceUrl+"geocode.json",t)}reverse(e,t){let s=e.lat+","+e.lng;this.options.reverseGeocodeProxRadius&&(s+=","+this.options.reverseGeocodeProxRadius);const o=p(this.options,{prox:s,mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1,maxresults:this.options.maxResults});return this.getJSON(this.options.serviceUrl+"reversegeocode.json",o)}async getJSON(e,t){return((await c(e,t)).response.view?.[0]?.result||[]).map(o=>{const r=o.location,a=new n.LatLng(r.displayPosition.latitude,r.displayPosition.longitude),d=new n.LatLngBounds(new n.LatLng(r.mapView.topLeft.latitude,r.mapView.topLeft.longitude),new n.LatLng(r.mapView.bottomRight.latitude,r.mapView.bottomRight.longitude));return{name:r.address.label,properties:r.address,bbox:d,center:a}})}}class U{options={serviceUrl:"https://geocode.search.hereapi.com/v1",apiKey:"",app_id:"",app_code:"",maxResults:10};constructor(e){n.Util.setOptions(this,e)}geocode(e){const t=l(this.options,{q:e,apiKey:this.options.apiKey,limit:this.options.maxResults});if(!t.at&&!t.in)throw Error("at / in parameters not found. Please define coordinates (at=latitude,longitude) or other (in) in your geocodingQueryParams.");return this.getJSON(this.options.serviceUrl+"/discover",t)}reverse(e,t){const s=p(this.options,{at:e.lat+","+e.lng,limit:this.options.reverseGeocodeProxRadius,apiKey:this.options.apiKey});return this.getJSON(this.options.serviceUrl+"/revgeocode",s)}async getJSON(e,t){return((await c(e,t)).items||[]).map(o=>{const r=new n.LatLng(o.position.lat,o.position.lng);let a;return o.mapView?a=new n.LatLngBounds(new n.LatLng(o.mapView.south,o.mapView.west),new n.LatLng(o.mapView.north,o.mapView.east)):a=new n.LatLngBounds(new n.LatLng(o.position.lat,o.position.lng),new n.LatLng(o.position.lat,o.position.lng)),{name:o.address.label,properties:o.address,bbox:a,center:r}})}}function $(i){return i?.apiKey?new U(i):new x(i)}function R(i){let e;if(e=i.match(/^([NS])\s*(\d{1,3}(?:\.\d*)?)\W*([EW])\s*(\d{1,3}(?:\.\d*)?)$/))return new n.LatLng((/N/i.test(e[1])?1:-1)*+e[2],(/E/i.test(e[3])?1:-1)*+e[4]);if(e=i.match(/^(\d{1,3}(?:\.\d*)?)\s*([NS])\W*(\d{1,3}(?:\.\d*)?)\s*([EW])$/))return new n.LatLng((/N/i.test(e[2])?1:-1)*+e[1],(/E/i.test(e[4])?1:-1)*+e[3]);if(e=i.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?$/))return new n.LatLng((/N/i.test(e[1])?1:-1)*(+e[2]+ +e[3]/60),(/E/i.test(e[4])?1:-1)*(+e[5]+ +e[6]/60));if(e=i.match(/^(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([NS])\W*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([EW])$/))return new n.LatLng((/N/i.test(e[3])?1:-1)*(+e[1]+ +e[2]/60),(/E/i.test(e[6])?1:-1)*(+e[4]+ +e[5]/60));if(e=i.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?$/))return new n.LatLng((/N/i.test(e[1])?1:-1)*(+e[2]+ +e[3]/60+ +e[4]/3600),(/E/i.test(e[5])?1:-1)*(+e[6]+ +e[7]/60+ +e[8]/3600));if(e=i.match(/^(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]\s*([NS])\W*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\s*([EW])$/))return new n.LatLng((/N/i.test(e[4])?1:-1)*(+e[1]+ +e[2]/60+ +e[3]/3600),(/E/i.test(e[8])?1:-1)*(+e[5]+ +e[6]/60+ +e[7]/3600));if(e=i.match(/^\s*([+-]?\d+(?:\.\d*)?)\s*[\s,]\s*([+-]?\d+(?:\.\d*)?)\s*$/))return new n.LatLng(+e[1],+e[2])}class E{options={next:void 0,sizeInMeters:1e4};constructor(e){n.Util.setOptions(this,e)}async geocode(e){const t=R(e);return t?[{name:e,center:t,bbox:t.toBounds(this.options.sizeInMeters)}]:this.options.next?this.options.next.geocode(e):[]}}function Q(i){return new E(i)}class O{options={serviceUrl:"https://api.mapbox.com/geocoding/v5/mapbox.places/"};constructor(e){n.Util.setOptions(this,e)}_getProperties(e){const t={text:e.text,address:e.address};return(e.context||[]).forEach(s=>{const o=s.id.split(".")[0];t[o]=s.text,s.short_code&&(t.countryShortCode=s.short_code)}),t}async geocode(e){const t=this.options.serviceUrl+encodeURIComponent(e)+".json",s=l(this.options,{access_token:this.options.apiKey});s.proximity!==void 0&&s.proximity.lat!==void 0&&s.proximity.lng!==void 0&&(s.proximity=s.proximity.lng+","+s.proximity.lat);const o=await c(t,s);return this._parseResults(o)}suggest(e){return this.geocode(e)}async reverse(e,t){const s=this.options.serviceUrl+e.lng+","+e.lat+".json",o=p(this.options,{access_token:this.options.apiKey}),r=await c(s,o);return this._parseResults(r)}_parseResults(e){return e.features?.length?e.features.map(t=>{const s=new n.LatLng(...t.center.reverse());let o;return t.bbox?o=new n.LatLngBounds(new n.LatLng(...t.bbox.slice(0,2).reverse()),new n.LatLng(...t.bbox.slice(2,4).reverse())):o=new n.LatLngBounds(s,s),{name:t.place_name,bbox:o,center:s,properties:this._getProperties(t)}}):[]}}function F(i){return new O(i)}class k{options={serviceUrl:"https://www.mapquestapi.com/geocoding/v1"};constructor(e){n.Util.setOptions(this,e),this.options.apiKey=decodeURIComponent(this.options.apiKey)}_formatName(...e){return e.filter(t=>!!t).join(", ")}async geocode(e){const t=l(this.options,{key:this.options.apiKey,location:e,limit:5,outFormat:"json"}),s=await c(this.options.serviceUrl+"/address",t);return this._parseResults(s)}async reverse(e,t){const s=p(this.options,{key:this.options.apiKey,location:e.lat+","+e.lng,outputFormat:"json"}),o=await c(this.options.serviceUrl+"/reverse",s);return this._parseResults(o)}_parseResults(e){return(e.results?.[0]?.locations||[]).map(s=>{const o=new n.LatLng(s.latLng.lat,s.latLng.lng);return{name:this._formatName(s.street,s.adminArea4,s.adminArea3,s.adminArea1),bbox:new n.LatLngBounds(o,o),center:o}})}}function Z(i){return new k(i)}class j{options={userId:"",apiKey:"",serviceUrl:"https://neutrinoapi.com/"};constructor(e){n.Util.setOptions(this,e)}async geocode(e){const t=l(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,address:e.split(/\s+/).join(".")}),s=await c(this.options.serviceUrl+"geocode-address",t);if(!s.locations)return[];s.geometry=s.locations[0];const o=new n.LatLng(s.geometry.latitude,s.geometry.longitude),r=new n.LatLngBounds(o,o);return[{name:s.geometry.address,bbox:r,center:o}]}suggest(e){return this.geocode(e)}async reverse(e,t){const s=p(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,latitude:e.lat,longitude:e.lng}),o=await c(this.options.serviceUrl+"geocode-reverse",s);if(o.status.status!==200||!o.found)return[];const r=new n.LatLng(e.lat,e.lng),a=new n.LatLngBounds(r,r);return[{name:o.address,bbox:a,center:r}]}}function X(i){return new j(i)}class L{options={serviceUrl:"https://nominatim.openstreetmap.org/",htmlTemplate(e){const t=e.address;let s;const o=[];return(t.road||t.building)&&o.push("{building} {road} {house_number}"),(t.city||t.town||t.village||t.hamlet)&&(s=o.length>0?"leaflet-control-geocoder-address-detail":"",o.push('<span class="'+s+'">{postcode} {city} {town} {village} {hamlet}</span>')),(t.state||t.country)&&(s=o.length>0?"leaflet-control-geocoder-address-context":"",o.push('<span class="'+s+'">{state} {country}</span>')),I(o.join("<br/>"),t)}};constructor(e){n.Util.setOptions(this,e||{})}async geocode(e){const t=l(this.options,{q:e,limit:5,format:"json",addressdetails:1});return(await c(this.options.serviceUrl+"search",t)).map(o=>{const r=o.boundingbox;return{icon:o.icon,name:o.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(o):void 0,bbox:new n.LatLngBounds([+r[0],+r[2]],[+r[1],+r[3]]),center:new n.LatLng(+o.lat,+o.lon),properties:o}})}async reverse(e,t){const s=p(this.options,{lat:e.lat,lon:e.lng,zoom:Math.round(Math.log(t/256)/Math.log(2)),addressdetails:1,format:"json"}),o=await c(this.options.serviceUrl+"reverse",s);if(!o?.lat||!o?.lon)return[];const r=new n.LatLng(+o.lat,+o.lon),a=new n.LatLngBounds(r,r);return[{name:o.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(o):void 0,center:r,bbox:a,properties:o}]}}function Y(i){return new L(i)}class C{options={};constructor(e){n.Util.setOptions(this,e)}async geocode(e){try{const t=this.options.OpenLocationCode.decode(e);return[{name:e,center:new n.LatLng(t.latitudeCenter,t.longitudeCenter),bbox:new n.LatLngBounds(new n.LatLng(t.latitudeLo,t.longitudeLo),new n.LatLng(t.latitudeHi,t.longitudeHi))}]}catch(t){return console.warn(t),[]}}async reverse(e,t){try{return[{name:this.options.OpenLocationCode.encode(e.lat,e.lng,this.options.codeLength),center:new n.LatLng(e.lat,e.lng),bbox:new n.LatLngBounds(new n.LatLng(e.lat,e.lng),new n.LatLng(e.lat,e.lng))}]}catch(s){return console.warn(s),[]}}}function ee(i){return new C(i)}class P{options={serviceUrl:"https://api.opencagedata.com/geocode/v1/json"};constructor(e){n.Util.setOptions(this,e)}async geocode(e){const t=l(this.options,{key:this.options.apiKey,q:e}),s=await c(this.options.serviceUrl,t);return this._parseResults(s)}suggest(e){return this.geocode(e)}async reverse(e,t){const s=p(this.options,{key:this.options.apiKey,q:[e.lat,e.lng].join(",")}),o=await c(this.options.serviceUrl,s);return this._parseResults(o)}_parseResults(e){return(e.results||[]).map(t=>{const s=new n.LatLng(t.geometry.lat,t.geometry.lng),o=t.annotations&&t.annotations.bounds?new n.LatLngBounds(new n.LatLng(t.annotations.bounds.northeast.lat,t.annotations.bounds.northeast.lng),new n.LatLng(t.annotations.bounds.southwest.lat,t.annotations.bounds.southwest.lng)):new n.LatLngBounds(s,s);return{name:t.formatted,bbox:o,center:s,properties:t}})}}function te(i){return new P(i)}class g{options={serviceUrl:"https://api.geocode.earth/v1"};constructor(e){n.Util.setOptions(this,e)}async geocode(e){const t=l(this.options,{api_key:this.options.apiKey,text:e}),s=await c(this.options.serviceUrl+"/search",t);return this._parseResults(s)}async suggest(e){const t=l(this.options,{api_key:this.options.apiKey,text:e}),s=await c(this.options.serviceUrl+"/autocomplete",t);return this._parseResults(s)}async reverse(e,t){const s=p(this.options,{api_key:this.options.apiKey,"point.lat":e.lat,"point.lon":e.lng}),o=await c(this.options.serviceUrl+"/reverse",s);return this._parseResults(o)}_parseResults(e){return(e.features||[]).map(t=>{const s=t.geometry.coordinates,o=new n.LatLng(s[1],s[0]),r=Array.isArray(t.bbox)&&t.bbox.length===4?new n.LatLngBounds([t.bbox[1],t.bbox[0]],[t.bbox[3],t.bbox[2]]):new n.LatLngBounds(o,o);return{name:t.properties.label,center:o,bbox:r,properties:t.properties}})}}function w(i){return new g(i)}const se=g,oe=w,ne=g,ie=w;class K extends g{constructor(e){super(Object.assign({serviceUrl:"https://api.openrouteservice.org/geocode"},e))}}function re(i){return new K(i)}class B{options={serviceUrl:"https://photon.komoot.io/api/",reverseUrl:"https://photon.komoot.io/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]};constructor(e){n.Util.setOptions(this,e)}async geocode(e,t){const s=l(this.options,{q:e}),o=t?.map?.getCenter?.();o&&(s.lat=o.lat,s.lon=o.lng);const r=t?.map?.getZoom?.();r&&(s.zoom=r);const a=await c(this.options.serviceUrl,s);return this._parseResults(a)}suggest(e){return this.geocode(e)}async reverse(e,t){const s=p(this.options,{lat:e.lat,lon:e.lng}),o=await c(this.options.reverseUrl,s);return this._parseResults(o)}_parseResults(e){return(e.features||[]).map(t=>{const s=t.geometry.coordinates,o=new n.LatLng(s[1],s[0]),r=t.properties?.extent,a=r?new n.LatLngBounds([r[1],r[0]],[r[3],r[2]]):new n.LatLngBounds(o,o);return{name:this._decodeFeatureName(t),html:this.options.htmlTemplate?this.options.htmlTemplate(t):void 0,center:o,bbox:a,properties:t.properties}})}_decodeFeatureName(e){return(this.options.nameProperties||[]).map(t=>e.properties?.[t]).filter(t=>!!t).join(", ")}}function ae(i){return new B(i)}class S{options={serviceUrl:"https://api.what3words.com/v2/"};constructor(e){n.Util.setOptions(this,e)}async geocode(e){const t=await c(this.options.serviceUrl+"forward",l(this.options,{key:this.options.apiKey,addr:e.split(/\s+/).join(".")}));if(!t.geometry)return[];const s=new n.LatLng(t.geometry.lat,t.geometry.lng),o=new n.LatLngBounds(s,s);return[{name:t.words,bbox:o,center:s}]}suggest(e){return this.geocode(e)}async reverse(e,t){const s=await c(this.options.serviceUrl+"reverse",p(this.options,{key:this.options.apiKey,coords:[e.lat,e.lng].join(",")}));if(s.status.status!=200)return[];const o=new n.LatLng(s.geometry.lat,s.geometry.lng),r=new n.LatLngBounds(o,o);return[{name:s.words,bbox:r,center:o}]}}function ce(i){return new S(i)}const T=Object.freeze(Object.defineProperty({__proto__:null,ArcGis:v,AzureMaps:b,Bing:_,GeocodeEarth:se,Google:y,HERE:x,HEREv2:U,LatLng:E,MapQuest:k,Mapbox:O,Mapzen:ne,Neutrino:j,Nominatim:L,OpenCage:P,OpenLocationCode:C,Openrouteservice:K,Pelias:g,Photon:B,What3Words:S,arcgis:q,azure:V,bing:H,geocodeEarth:oe,geocodingParams:l,google:J,here:$,latLng:Q,mapQuest:Z,mapbox:F,mapzen:ie,neutrino:X,nominatim:Y,openLocationCode:ee,opencage:te,openrouteservice:re,parseLatLng:R,pelias:w,photon:ae,reverseParams:p,what3words:ce},Symbol.toStringTag,{value:"Module"}));class f{constructor(...e){}}Object.getOwnPropertyNames(n.Control.prototype).forEach(i=>f.prototype[i]=n.Control.prototype[i]),Object.getOwnPropertyNames(n.Evented.prototype).forEach(i=>f.prototype[i]=n.Evented.prototype[i]);class m extends f{options={showUniqueResult:!0,showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",iconLabel:"Initiate a new search",query:"",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0};_alts;_container;_errorElement;_geocodeMarker;_input;_lastGeocode;_map;_preventBlurCollapse;_requestCount=0;_results;_selection;_suggestTimeout;constructor(e){super(e),n.Util.setOptions(this,e),this.options.geocoder||(this.options.geocoder=new L)}addThrobberClass(){this._container.classList.add("leaflet-control-geocoder-throbber")}removeThrobberClass(){this._container.classList.remove("leaflet-control-geocoder-throbber")}onAdd(e){const t="leaflet-control-geocoder",s=n.DomUtil.create("div",t+" leaflet-bar"),o=n.DomUtil.create("a",t+"-icon",s),r=n.DomUtil.create("div",t+"-form",s);this._map=e,this._container=s,o.innerHTML="&nbsp;",o.setAttribute("aria-label",this.options.iconLabel);const a=this._input=n.DomUtil.create("input","",r);return a.type="search",a.value=this.options.query,a.placeholder=this.options.placeholder,n.DomEvent.disableClickPropagation(a),this._errorElement=n.DomUtil.create("div",t+"-form-no-error",s),this._errorElement.innerHTML=this.options.errorMessage,this._alts=n.DomUtil.create("ul",t+"-alternatives leaflet-control-geocoder-alternatives-minimized",s),n.DomEvent.disableClickPropagation(this._alts),n.DomEvent.on(a,"keydown",this._keydown,this),this.options.geocoder?.suggest&&n.DomEvent.on(a,"input",this._change,this),n.DomEvent.on(a,"blur",()=>{this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1}),this.options.collapsed?this.options.expand==="click"?n.DomEvent.on(s,"click",d=>{d.button===0&&d.detail!==2&&this._toggle()}):this.options.expand==="touch"?n.DomEvent.on(s,n.Browser.touch?"touchstart mousedown":"mousedown",d=>{this._toggle(),d.preventDefault(),d.stopPropagation()},this):(n.DomEvent.on(s,"mouseover",this._expand,this),n.DomEvent.on(s,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),n.Browser.touch?n.DomEvent.on(s,"touchstart",()=>this._geocode()):n.DomEvent.on(s,"click",()=>this._geocode())),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",this.addThrobberClass,this),this.on("finishgeocode",this.removeThrobberClass,this),this.on("startsuggest",this.addThrobberClass,this),this.on("finishsuggest",this.removeThrobberClass,this),n.DomEvent.disableClickPropagation(s),s}setQuery(e){return this._input.value=e,this}_geocodeResult(e,t){!t&&this.options.showUniqueResult&&e.length===1?this._geocodeResultSelected(e[0]):e.length>0?(this._alts.innerHTML="",this._results=e,this._alts.classList.remove("leaflet-control-geocoder-alternatives-minimized"),this._container.classList.add("leaflet-control-geocoder-options-open"),this._results.forEach((s,o)=>this._alts.appendChild(this._createAlt(s,o)))):(this._container.classList.add("leaflet-control-geocoder-options-error"),this._errorElement.classList.add("leaflet-control-geocoder-error"))}markGeocode(e){const t=e.geocode;return this._map.fitBounds(t.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new n.Marker(t.center).bindPopup(t.html||t.name).addTo(this._map).openPopup(),this}async _geocode(e=!1){const t=this._input.value;if(!e&&t.length<this.options.queryMinLength)return;const s=++this._requestCount;this._lastGeocode=t,e||this._clearResults();const o={input:t};this.fire(e?"startsuggest":"startgeocode",o);const r={map:this._map},a=e?await this.options.geocoder.suggest(t,r):await this.options.geocoder.geocode(t,r);if(s===this._requestCount){const d={input:t,results:a};this.fire(e?"finishsuggest":"finishgeocode",d),this._geocodeResult(a,e)}}_geocodeResultSelected(e){const t={geocode:e};this.fire("markgeocode",t)}_toggle(){this._container.classList.contains("leaflet-control-geocoder-expanded")?this._collapse():this._expand()}_expand(){this._container.classList.add("leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")}_collapse(){this._container.classList.remove("leaflet-control-geocoder-expanded"),this._alts.classList.add("leaflet-control-geocoder-alternatives-minimized"),this._errorElement.classList.remove("leaflet-control-geocoder-error"),this._container.classList.remove("leaflet-control-geocoder-options-open"),this._container.classList.remove("leaflet-control-geocoder-options-error"),this._input.blur(),this.fire("collapse")}_clearResults(){this._alts.classList.add("leaflet-control-geocoder-alternatives-minimized"),this._selection=null,this._errorElement.classList.remove("leaflet-control-geocoder-error"),this._container.classList.remove("leaflet-control-geocoder-options-open"),this._container.classList.remove("leaflet-control-geocoder-options-error")}_createAlt(e,t){const s=n.DomUtil.create("li",""),o=n.DomUtil.create("a","",s),r=this.options.showResultIcons&&e.icon?n.DomUtil.create("img","",o):null,a=e.html?void 0:document.createTextNode(e.name),d=le=>{this._preventBlurCollapse=!0,n.DomEvent.stop(le),this._geocodeResultSelected(e),n.DomEvent.on(s,"click touchend",()=>{this.options.collapsed?this._collapse():this._clearResults()})};return r&&(r.src=e.icon),s.setAttribute("data-result-index",String(t)),e.html?o.innerHTML=o.innerHTML+e.html:a&&o.appendChild(a),n.DomEvent.on(s,"mousedown touchstart",d,this),s}_keydown(e){const t=s=>{this._selection&&(this._selection.classList.remove("leaflet-control-geocoder-selected"),this._selection=this._selection[s>0?"nextSibling":"previousSibling"]),this._selection||(this._selection=this._alts[s>0?"firstChild":"lastChild"]),this._selection&&this._selection.classList.add("leaflet-control-geocoder-selected")};switch(e.key){case"Escape":this.options.collapsed?this._collapse():this._clearResults();break;case"ArrowUp":t(-1);break;case"ArrowDown":t(1);break;case"Enter":if(this._selection){const s=parseInt(this._selection.getAttribute("data-result-index"),10);this._geocodeResultSelected(this._results[s]),this._clearResults()}else this._geocode();break;default:return}n.DomEvent.preventDefault(e)}_change(){const e=this._input.value;e!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),e.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout(()=>this._geocode(!0),this.options.suggestTimeout):this._clearResults())}}function M(i){return new m(i)}/* @preserve
 * Leaflet Control Geocoder
 * https://github.com/perliedman/leaflet-control-geocoder
 *
 * Copyright (c) 2012 sa3m (https://github.com/sa3m)
 * Copyright (c) 2018 Per Liedman
 * All rights reserved.
 */Object.assign(m,T),Object.assign(n.Control,{Geocoder:m,geocoder:M}),u.Geocoder=m,u.default=m,u.geocoder=M,u.geocoders=T,Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
